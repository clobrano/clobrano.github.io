<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Python, you've got an e-mail &#8211; Quantum Leap</title>
<meta name="description" content="Python company's e-mail notifier">
<meta name="keywords" content="automation, python">



<!-- Twitter Cards -->
<meta name="twitter:title" content="Python, you've got an e-mail">
<meta name="twitter:description" content="Python company's e-mail notifier">
<meta name="twitter:site" content="@carlolobrano">
<meta name="twitter:creator" content="@carlolobrano">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://localhost:4000/images/python-email2.jpg">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Python, you've got an e-mail">
<meta property="og:description" content="Python company's e-mail notifier">
<meta property="og:url" content="http://localhost:4000/articles/python-you-ve-got-an-email/">
<meta property="og:site_name" content="Quantum Leap">





<link rel="canonical" href="http://localhost:4000/articles/python-you-ve-got-an-email/">
<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Quantum Leap Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">
<!-- Webfonts -->
<script src="https://use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
  <script src="http://localhost:4000/assets/js/vendor/html5shiv.min.js"></script>
  <script src="http://localhost:4000/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="http://localhost:4000/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>


<!-- MathJax -->
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://localhost:4000/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav" class="animated drop">
	    <ul>
      
		    
		        
		    
		    <li><a href="http://localhost:4000/about/" >About</a></li>
		  
		    
		        
		    
		    <li><a href="http://localhost:4000/articles/" >Articles</a></li>
		  
		    
		        
		    
		    <li><a href="http://localhost:4000/blog/" >Blog</a></li>
		  
		    
		        
		    
		    <li><a href="http://localhost:4000/tags/" >Tags</a></li>
		  
		    
		        
		    
		    <li><a href="http://localhost:4000/search/" >Search</a></li>
		  
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<header class="masthead">
	
		<div class="wrap">
			<a href="http://localhost:4000/" class="site-logo" rel="home" title="Quantum Leap"><img src="http://localhost:4000/images/site-logo.png" width="200" height="200" alt="Quantum Leap logo" class="animated fadeInDown"></a>
		</div>
	
</header><!-- /.masthead -->


<div class="js-menu-screen menu-screen"></div>


<div id="main" role="main">
  <article class="hentry">
    <img src="http://localhost:4000/images/python-email2.jpg" class="entry-feature-image" alt="Python, you've got an e-mail" >
    <div class="entry-wrapper">
      <header class="entry-header">
        <span class="entry-tags"><a href="http://localhost:4000/tags/#automation" title="Pages tagged automation">automation</a>&nbsp;&bull;&nbsp;<a href="http://localhost:4000/tags/#python" title="Pages tagged python">python</a></span>
        
          <h1 class="entry-title">Python, you've got an e-mail</h1>
        
      </header>
      <footer class="entry-meta">
        
        
        
          <img src="http://localhost:4000/images/bio-photo.jpg" class="bio-photo" alt="Carlo Lobrano bio photo"></a>
        
        <span class="author vcard">By <span class="fn">Carlo Lobrano</span></span>
        <span class="entry-date date published"><time datetime="2015-04-27T00:00:00+02:00"><i class="fa fa-calendar-o"></i> April 27, 2015</time></span>
        
        
        
        
      </footer>
      <div class="entry-content">
        <p>Ok, you landed in a new IT company and you are very excited to start working.
You have got an <strong>e-mail</strong> address, a <strong>calendar</strong> for meetings, deadlines, planning, holidays (yeah) and very likely an <strong>istant messaging</strong> system and all is under Microsoft Exchange<a rel="nofollow" href="#footnote1" id="ref_footnote1"><sup>1</sup></a>, however you are a Linux developer and you have to (or you just prefer to) work with a GNU/Linux OS, so the question is: <strong>what e-mail client is OK for Linux</strong>?</p>

<p>I actually try and use lot of desktop e-mail clients. <a href="https://www.mozilla.org/en-US/thunderbird/"><strong>Thunderbird</strong></a> (with <a href="https://www.mozilla.org/en-US/projects/calendar/">Lightning</a> for calendar) is probably the best, but it is huge in memory consumption. <a href="https://wiki.gnome.org/Apps/Evolution"><strong>Evolution</strong></a> is my preferred, above all for the clean and efficient interface, but is not always easy to configure and quite slow at startup when it tries to syncronize your e-mails. <a href="https://userbase.kde.org/KMail"><strong>KMail</strong></a> is nice as well as Evolution (maybe even better), but I mostly run Gtk windows environment so I prefer not to download all its KDE dependencies.</p>

<p>How not to mention also that if you choose a “custom” client <strong>the responsility</strong> for each problem (e.g. e-mails not received on time, impossibility to send important e-mails…) <strong>is yours</strong><a rel="nofollow" href="#footnote2" id="ref_footnote2"><sup>2</sup></a>.</p>

<p>The query <u>linux email client exchange 2010</u> (at 12:32 PM of Saturday, April 25, 2015 (GMT+2)) returns more than 1 Millions results, so I am not about to talk about the best e-mail client and their configuration today. I just want to say that <strong>you may not need a desktop client</strong>. Luckily the Outlook web app is perfectly fine for most of my needs and more important the things that it does not provide are basicaly the same you won’t have with any Linux desktop client anyway.</p>

<p>The only important thing here is <strong>getting notified about new e-mails</strong>. Again, there are some solution ready to be installed, but apart from the fact that some of them just does not work<a rel="nofollow" href="#footnote3" id="ref_footnote3"><sup>3</sup></a>, it is a lot funnier trying something on my own.</p>

<p>I had got no much time to spend developing a new notifier, so I choose to write it in Python, that provides the <a href="https://docs.python.org/2/library/imaplib.html">imaplib</a> module to manage IMAP4 protocol.</p>

<p>The basic steps are the following:</p>

<h2 id="connection">Connection</h2>

<p>Better if through SSL like this</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">getpass</span>
<span class="kn">import</span> <span class="nn">imaplib</span>

<span class="n">M</span> <span class="o">=</span> <span class="n">imaplib</span><span class="o">.</span><span class="n">IMAP4_SSL</span> <span class="p">(</span><span class="n">EMAIL_IMAP_SERVER</span><span class="p">)</span></code></pre></div>

<h2 id="login">Login</h2>

<p>Here we have some options. <strong>Password can not be revealed</strong>, so we can provide a <strong>crypted file with the password</strong> or use <a href="https://docs.python.org/2/library/getpass.html"><strong>getpass</strong></a> Python module that provide a <u>prompt for the user without echoing</u> (that is, no one can see what you are typing).</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">password</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getpass</span> <span class="p">()</span>
<span class="n">rv</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">EMAIL_ACCOUNT</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span></code></pre></div>

<h2 id="get-your-data">Get your data</h2>

<p>I was tempted to build an entire new e-mail client, but let’s start with little things: the <strong>number of unseen e-mail from the inbox</strong>.</p>

<ul>
  <li>Select a <em>mailbox</em>. My account has a mailbox called <em>INBOX</em> for example. As you can see in the code above, the library functions returns a tuple composed by a sort of status <code>rv</code> (it is a string, like ‘OK’) and the actual <code>data</code>.</li>
</ul>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">rv</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s">&#39;INBOX&#39;</span><span class="p">)</span></code></pre></div>

<ul>
  <li>If in the previous step <code>rv == 'OK'</code>, you can ask the status of the choosen mailbox (I went through some try and error to understand how query my e-mail).</li>
</ul>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">rv</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="s">&#39;INBOX&#39;</span><span class="p">,</span> <span class="s">&#39;(UNSEEN)&#39;</span><span class="p">)</span></code></pre></div>

<ul>
  <li>The <code>status</code> returned in the previous step is verbose (like: ‘Unseen email: 10’) so I used regular expression to extract just a number.</li>
</ul>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">unseen</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;[0-9]+&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></code></pre></div>

<h2 id="notify">Notify</h2>

<p>This is simple enough, using <strong>pynotify</strong> module which is a python binding for libnotify.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">signal</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
	<span class="k">if</span> <span class="n">notify</span> <span class="o">==</span> <span class="s">&#39;on&#39;</span><span class="p">:</span>
		<span class="n">message</span> <span class="o">+=</span> <span class="s">&#39; {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
		<span class="n">pynotify</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="s">&#39;PyEmail&#39;</span><span class="p">)</span>
		<span class="n">notification</span> <span class="o">=</span> <span class="n">pynotify</span><span class="o">.</span><span class="n">Notification</span><span class="p">(</span><span class="s">&#39;PyEmail&#39;</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
		<span class="n">notification</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre></div>

<h2 id="conclusion">Conclusion</h2>

<p>There are other things to be considered, like a <em>mainloop</em>, <em>exceptions</em> and provide command-line arguments (for which I used the excellent module <a href="http://docopt.org/">docopt</a>). For all those things here is the link of the <a href="https://github.com/clobrano/imap-email-checker">complete project</a> on github.</p>

<h4 id="notes">Notes</h4>

<ol>
  <li>Lately some companies are providing alternatives (like <a href="https://www.google.com/work/apps/business/">Google Apps</a> and there are mixed solutions with e-mail from a source an IM from another), but in most instances you will work with Microsoft Exchange. I am a Linux guy, but I won’t say nothing against this choice. It just works and when it does not there is an helpdesk to call and that is perfectly fine for most of the people that works in every company<a rel="nofollow" href="#ref_footnote1" id="footnote1">[↩]</a>.</li>
  <li>Of course you are a Linux developer, so you can manage responsability :), but it was something I just had to say<a rel="nofollow" href="#ref_footnote2" id="footnote2">[↩]</a>.</li>
  <li>See above for my idea about things you have to struggle with v.s. things that just works<a rel="nofollow" href="#ref_footnote3" id="footnote3">[↩]</a>.</li>
</ol>


        
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="http://localhost:4000/articles/git-in-the-shell-integration/" class="btn" title="Git in the Shell. Integration">Previous</a>
      
      
        <a href="http://localhost:4000/articles/library-tell-me-what-i-want-to-hear/" class="btn" title="Testing: Library, tell me what I want to hear!">Next</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo" class="entry-wrapper">
    

<span>&copy; 2015 Carlo Lobrano. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://mademistakes.com/so-simple/" rel="nofollow">So Simple Theme</a>.</span>
<div class="social-icons">
	<a href="https://twitter.com/carlolobrano" title="Carlo Lobrano on Twitter" target="_blank"><i class="fa fa-twitter-square fa-2x"></i></a>
	
	
	<a href="https://linkedin.com/in/carlolobrano" title="Carlo Lobrano on LinkedIn" target="_blank"><i class="fa fa-linkedin-square fa-2x"></i></a>
	<a href="http://stackoverflow.com/users/1197008/carlo" title="Carlo Lobrano on StackExchange" target="_blank"><i class="fa fa-stack-exchange fa-2x"></i></a>
	<a href="https://instagram.com/carlo.lobrano" title="Carlo Lobrano on Instagram" target="_blank"><i class="fa fa-instagram fa-2x"></i></a>
	
	<a href="https://github.com/clobrano" title="Carlo Lobrano on Github" target="_blank"><i class="fa fa-github-square fa-2x"></i></a>
	
  
	
  <a href="http://localhost:4000/feed.xml" title="Atom/RSS feed"><i class="fa fa-rss-square fa-2x"></i></a>
</div><!-- /.social-icons -->

  </footer>
</div><!-- /.footer-wrapper -->

<script type="text/javascript">
  var BASE_URL = 'http://localhost:4000';
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://localhost:4000/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://localhost:4000/assets/js/scripts.min.js"></script>




</body>
</html>
